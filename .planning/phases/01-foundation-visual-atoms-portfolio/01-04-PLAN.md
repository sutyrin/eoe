---
phase: 01-foundation-visual-atoms-portfolio
plan: 04
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - cli/commands/note.js
  - cli/commands/status.js
  - cli/index.js
  - dashboard/index.html
  - dashboard/style.css
autonomous: true

must_haves:
  truths:
    - "User can run `eoe note \"swirling galaxy\"` and see it appended to ideas.md"
    - "User can run `eoe status` and see a table of all atoms with name, stage, created, last-modified"
    - "User can open the dev dashboard in browser and see thumbnails of all atoms"
    - "Clicking an atom thumbnail in dashboard opens that atom's dev page"
  artifacts:
    - path: "cli/commands/note.js"
      provides: "eoe note command for idea capture"
      contains: "noteCommand"
    - path: "cli/commands/status.js"
      provides: "eoe status command showing atom table"
      contains: "statusCommand"
    - path: "dashboard/index.html"
      provides: "Dev dashboard with atom gallery"
      contains: "atom"
    - path: "dashboard/style.css"
      provides: "Dashboard styling"
      contains: "grid"
  key_links:
    - from: "cli/index.js"
      to: "cli/commands/note.js"
      via: "commander addCommand"
      pattern: "addCommand.*noteCommand"
    - from: "cli/index.js"
      to: "cli/commands/status.js"
      via: "commander addCommand"
      pattern: "addCommand.*statusCommand"
    - from: "cli/commands/note.js"
      to: "ideas.md"
      via: "fs.appendFile"
      pattern: "appendFile.*ideas"
    - from: "cli/commands/status.js"
      to: "atoms/"
      via: "fs.readdirSync to discover atoms"
      pattern: "readdirSync.*atoms"
    - from: "dashboard/index.html"
      to: "atoms/"
      via: "fetch to discover atom folders"
      pattern: "atoms"
---

<objective>
Create the note-taking CLI commands (note + status) and the dev dashboard page. After this plan, users can capture ideas from terminal, track atom progress at a glance, and browse all atoms in a local gallery.

Purpose: Completes the creative workflow loop -- create, develop, capture ideas, track progress, browse gallery. Covers NOTE-01, NOTE-02, and the dev dashboard (CONTEXT.md decision: "gallery of recent work -- thumbnails you can click into").
Output: Working `eoe note` and `eoe status` commands plus a local dev dashboard HTML page served by Vite.
</objective>

<execution_context>
@/home/pavel/.claude/get-shit-done/workflows/execute-plan.md
@/home/pavel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-visual-atoms-portfolio/01-CONTEXT.md
@.planning/phases/01-foundation-visual-atoms-portfolio/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create note and status CLI commands</name>
  <files>
    cli/commands/note.js
    cli/commands/status.js
    cli/index.js
  </files>
  <action>
Add the `note` and `status` commands to the CLI.

**cli/commands/note.js** -- Quick idea capture:
```javascript
import { Command } from 'commander';
import fs from 'fs-extra';
import path from 'path';
import chalk from 'chalk';

export const noteCommand = new Command('note')
  .argument('<text>', 'Idea or note text')
  .description('Capture a quick idea to ideas.md')
  .action(async (text) => {
    const ideasPath = path.resolve('ideas.md');

    // Create ideas.md if it doesn't exist
    if (!await fs.pathExists(ideasPath)) {
      await fs.writeFile(ideasPath, '# Ideas\n\nQuick-capture creative ideas. Add via `eoe note "your idea"` or edit directly.\n\n---\n');
    }

    const timestamp = new Date().toISOString().replace('T', ' ').split('.')[0];
    const entry = `\n- **${timestamp}:** ${text}\n`;
    await fs.appendFile(ideasPath, entry);

    console.log(chalk.green(`Noted: "${text}"`));
    console.log(chalk.gray(`  Saved to ideas.md`));
  });
```

Key behaviors:
- Appends timestamped entry to ideas.md at repo root
- Creates ideas.md with header if it doesn't exist (idempotent)
- Entry format: `- **YYYY-MM-DD HH:MM:SS:** idea text`
- Converges with direct markdown editing (same file, both paths per CONTEXT.md)

**cli/commands/status.js** -- Atom status table:
```javascript
import { Command } from 'commander';
import fs from 'fs-extra';
import path from 'path';
import chalk from 'chalk';

export const statusCommand = new Command('status')
  .description('Show status of all atoms')
  .action(async () => {
    const atomsDir = path.resolve('atoms');

    if (!await fs.pathExists(atomsDir)) {
      console.log(chalk.yellow('No atoms directory found'));
      return;
    }

    const entries = await fs.readdir(atomsDir, { withFileTypes: true });
    const atoms = entries.filter(d => d.isDirectory());

    if (atoms.length === 0) {
      console.log(chalk.yellow('No atoms yet. Run `eoe create visual <name>` to start.'));
      return;
    }

    // Collect atom data
    const rows = [];
    for (const atom of atoms) {
      const atomPath = path.join(atomsDir, atom.name);
      const notesPath = path.join(atomPath, 'NOTES.md');
      const stat = await fs.stat(atomPath);

      let stage = 'idea';
      if (await fs.pathExists(notesPath)) {
        const notes = await fs.readFile(notesPath, 'utf8');
        const stageMatch = notes.match(/\*\*Stage:\*\*\s*(\w+)/);
        if (stageMatch) stage = stageMatch[1];
      }

      // Parse name and date from folder name
      const parts = atom.name.match(/^(\d{4}-\d{2}-\d{2})-(.+)$/);
      const date = parts ? parts[1] : 'unknown';
      const name = parts ? parts[2] : atom.name;

      rows.push({
        name,
        stage,
        created: date,
        modified: stat.mtime.toISOString().split('T')[0]
      });
    }

    // Sort newest first
    rows.sort((a, b) => b.created.localeCompare(a.created));

    // Print table
    const stageColors = {
      idea: chalk.gray,
      sketch: chalk.blue,
      refine: chalk.yellow,
      done: chalk.green
    };

    // Calculate column widths
    const nameWidth = Math.max(4, ...rows.map(r => r.name.length));
    const header = `${'NAME'.padEnd(nameWidth)}  ${'STAGE'.padEnd(7)}  ${'CREATED'.padEnd(10)}  MODIFIED`;
    console.log(chalk.bold(header));
    console.log('-'.repeat(header.length));

    for (const row of rows) {
      const colorFn = stageColors[row.stage] || chalk.white;
      console.log(
        `${row.name.padEnd(nameWidth)}  ${colorFn(row.stage.padEnd(7))}  ${row.created.padEnd(10)}  ${row.modified}`
      );
    }

    console.log(chalk.gray(`\n${rows.length} atom(s)`));
  });
```

Key behaviors:
- Reads all atom folders from atoms/
- Parses stage from NOTES.md `**Stage:** <value>` pattern (LOCKED: idea/sketch/refine/done)
- Extracts name and date from folder name (YYYY-MM-DD-name pattern)
- Table format with columns: NAME, STAGE, CREATED, MODIFIED (CONTEXT.md decision)
- Color-coded stages for scanability at 20+ atoms
- Sorted newest first

**Update cli/index.js** -- Add new commands:
Add imports for noteCommand and statusCommand, then add them with program.addCommand(). The existing imports for createCommand and devCommand remain unchanged.

```javascript
#!/usr/bin/env node
import { program } from 'commander';
import { createCommand } from './commands/create.js';
import { devCommand } from './commands/dev.js';
import { noteCommand } from './commands/note.js';
import { statusCommand } from './commands/status.js';

program
  .name('eoe')
  .description('Engines of Experience - Creative atom toolkit')
  .version('1.0.0');

program.addCommand(createCommand);
program.addCommand(devCommand);
program.addCommand(noteCommand);
program.addCommand(statusCommand);

program.parse();
```

After updating cli/index.js, run `npm install` from project root to ensure all CLI dependencies are up to date.
  </action>
  <verify>
1. `eoe note "swirling galaxy with noise fields"` -- appends entry to ideas.md, prints confirmation
2. `cat ideas.md` -- shows timestamped entry with the text
3. `eoe note "another idea"` -- second entry appears below first
4. `eoe status` -- shows table with all existing atoms (from Plan 02 test atoms, or empty state message)
5. `eoe --help` -- shows all 4 commands: create, dev, note, status
6. Stage colors work: create an atom, then manually change `**Stage:** sketch` in NOTES.md, run `eoe status` to see blue stage text
  </verify>
  <done>
`eoe note` appends timestamped ideas to ideas.md. `eoe status` displays a color-coded table of all atoms with name, stage, created date, and last-modified date. CLI has 4 commands: create, dev, note, status.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dev dashboard page</name>
  <files>
    dashboard/index.html
    dashboard/style.css
  </files>
  <action>
Create the dev dashboard -- a local page served by Vite that shows all atoms as a gallery. This is the first thing devs see when running `npx vite` (configured in vite.config.js from Plan 01 to open /dashboard/).

**dashboard/index.html:**
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EOE Dashboard</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <header>
    <h1>Engines of Experience</h1>
    <p class="subtitle">Dev Dashboard</p>
  </header>

  <main id="gallery">
    <p class="loading">Scanning atoms...</p>
  </main>

  <script type="module">
    // In Vite dev mode, we can fetch the directory listing
    // Since Vite serves the entire project, we scan known atom folders
    // Strategy: Try to fetch each atom's config.json to confirm it exists

    async function loadAtoms() {
      const gallery = document.getElementById('gallery');

      try {
        // Fetch the atoms directory listing via a simple approach:
        // We'll look for atoms by trying to fetch from known locations
        // In dev mode, Vite serves everything under project root
        const response = await fetch('/atoms/');
        const html = await response.text();

        // Vite directory listing returns HTML with links
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const links = [...doc.querySelectorAll('a')]
          .map(a => a.textContent.replace('/', ''))
          .filter(name => /^\d{4}-\d{2}-\d{2}-.+/.test(name));

        if (links.length === 0) {
          gallery.innerHTML = `
            <div class="empty-state">
              <p>No atoms yet</p>
              <code>eoe create visual &lt;name&gt;</code>
              <p class="hint">Then run <code>eoe dev &lt;atom&gt;</code> to start creating</p>
            </div>
          `;
          return;
        }

        // Sort newest first
        links.sort((a, b) => b.localeCompare(a));

        gallery.innerHTML = links.map(atomName => {
          const parts = atomName.match(/^(\d{4}-\d{2}-\d{2})-(.+)$/);
          const date = parts ? parts[1] : '';
          const name = parts ? parts[2] : atomName;

          return `
            <a href="/atoms/${atomName}/index.html" class="atom-card">
              <div class="atom-preview">
                <iframe
                  src="/atoms/${atomName}/index.html"
                  width="400"
                  height="400"
                  loading="lazy"
                  title="${name}"
                ></iframe>
              </div>
              <div class="atom-info">
                <span class="atom-name">${name}</span>
                <span class="atom-date">${date}</span>
              </div>
            </a>
          `;
        }).join('');

      } catch (e) {
        gallery.innerHTML = `
          <div class="empty-state">
            <p>No atoms yet</p>
            <code>eoe create visual &lt;name&gt;</code>
          </div>
        `;
      }
    }

    loadAtoms();
  </script>
</body>
</html>
```

**dashboard/style.css:**
```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
  background: #0a0a0a;
  color: #e0e0e0;
  min-height: 100vh;
}

header {
  padding: 2rem;
  border-bottom: 1px solid #222;
}

h1 {
  font-size: 1.4rem;
  color: #fff;
}

.subtitle {
  color: #666;
  font-size: 0.85rem;
  margin-top: 0.25rem;
}

main {
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

#gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 1.5rem;
}

.loading {
  color: #666;
  grid-column: 1 / -1;
}

.empty-state {
  grid-column: 1 / -1;
  text-align: center;
  padding: 4rem 2rem;
  color: #666;
}

.empty-state code {
  display: block;
  margin: 1rem 0;
  color: #6bb5ff;
  font-size: 1.1rem;
}

.empty-state .hint {
  font-size: 0.85rem;
  margin-top: 0.5rem;
}

.atom-card {
  background: #151515;
  border: 1px solid #222;
  border-radius: 8px;
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  transition: border-color 0.2s, transform 0.1s;
}

.atom-card:hover {
  border-color: #444;
  transform: translateY(-2px);
}

.atom-preview {
  width: 100%;
  height: 200px;
  overflow: hidden;
  background: #0a0a0a;
  position: relative;
}

.atom-preview iframe {
  border: none;
  pointer-events: none;
  transform: scale(0.5);
  transform-origin: top left;
  position: absolute;
  top: 0;
  left: 0;
}

.atom-info {
  padding: 0.75rem 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.atom-name {
  color: #fff;
  font-weight: 600;
  font-size: 0.9rem;
}

.atom-date {
  color: #555;
  font-size: 0.75rem;
}
```

The dashboard uses Vite's directory listing feature in dev mode to discover atoms. It renders each atom as a card with an iframe preview (scaled down to thumbnail size, pointer-events disabled to prevent interaction on the grid -- click the card to open the full atom).

Note: Remove the `.gitkeep` file from dashboard/ since we now have actual files there. The `.gitkeep` from Plan 01 was a placeholder.
  </action>
  <verify>
1. `npx vite` from project root opens browser to dashboard page
2. Dashboard shows "EOE Dashboard" header
3. If atoms exist: grid of atom cards with iframe previews and names
4. If no atoms: empty state with `eoe create visual <name>` prompt
5. Clicking an atom card navigates to the full atom dev page
6. Grid is responsive -- cards reflow on window resize
7. Dark theme with monospace font throughout
  </verify>
  <done>
Dev dashboard serves as the local gallery page showing all atoms as a grid with iframe previews. Clicking any atom opens its full dev page. Empty state guides user to create first atom. Dashboard opens by default when running `npx vite`.
  </done>
</task>

</tasks>

<verification>
1. `eoe note "test idea"` appends to ideas.md with timestamp
2. `eoe status` shows table of atoms (or helpful empty message)
3. `npx vite` opens dashboard in browser
4. Dashboard discovers and displays existing atoms as thumbnail grid
5. Clicking atom thumbnail opens the atom's dev page with live sketch
6. Full CLI: `eoe --help` shows create, dev, note, status commands
7. Full creative loop works: create -> dev -> note -> status -> dashboard
</verification>

<success_criteria>
- `eoe note` captures ideas to ideas.md with timestamp (NOTE-01)
- `eoe status` shows table with NAME, STAGE, CREATED, MODIFIED columns (NOTE-02 partial)
- Stage colors: idea (gray), sketch (blue), refine (yellow), done (green)
- Status reads stage from NOTES.md `**Stage:** value` pattern
- Dev dashboard auto-discovers atoms from atoms/ directory
- Dashboard shows thumbnail previews via scaled iframes
- Dashboard opens by default with `npx vite`
- Empty states handled gracefully in both status and dashboard
- All 4 CLI commands available: create, dev, note, status
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-visual-atoms-portfolio/01-04-SUMMARY.md`
</output>
