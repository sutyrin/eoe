# AGENTS (docs)

Общие сведения по репозиторию и процессу разработки. Не дублировать в игровых AGENTS.md.

## Общие сведения

В этом репозитории разрабатывается серия маленьких онлайн-игр по общим технологиям.
Основной фреймворк — Phaser 3. Каждая игра — отдельный подкаталог с `index.html`.

## Особенности разработки

- ИИ-агенты документируют деятельность в AGENTS.md на уровне нужной директории.
- Основное тестирование идет через game api; часть проверок — e2e через UI.
- Геймплей пошаговый, чтобы агент мог спокойно анализировать состояние.
- Целевой UX — мобильный портрет, контролы в нижней трети экрана.

## Экран, перф, логирование

- Ориентация: портрет, мобильный фуллскрин.
- Производительность: FPS 30+ и минимальный бандл; избегать тяжелых ассетов.
- Логи: единый формат логов, пока что заправлены в консоль, впоследствии — будут шиппиться по сети

## Структура разработки (черновик)

Корень репозитория:
```
/packages/
  game-api/          # общий MCP Game API: адаптеры, типы, тестовые утилиты
  game-core/         # общий слой логики (state, reducers, random, helpers)
  ui-shared/         # общие UI-компоненты и темы (минимально, при необходимости)
/games/
  steppy-scroller/   # игра steppy scroller
  phaser3-test/      # игра phaser3 test
  kaboom-test/       # игра kaboom test
/docs/               # общая документация
```

Шаблон структуры для каждой игры (по имени game-name):
```
/games/<game-name>/
  index.html
  src/
    main.ts          # точка входа
    game/            # логика/сцены/состояние
    mcp/             # glue-код для MCP Game API (эндпоинты, адаптеры)
    ui/              # UI-слой и отображение состояния
  assets/            # спрайты/шрифты/звуки
  tests/
    unit/            # юнит-тесты
    api/             # сценарии через MCP Game API
    e2e/             # минимальные UI проверки
  README.md          # краткий гайд по запуску и тестам
```

Правило: любая игра должна работать из своего подкаталога без ручной подстройки путей.

## Тестовая пирамида (практически)

- 60–80% — юнит-тесты JS/TS (логика, утилиты, генераторы).
- 15–30% — game api тесты (сценарии хода/состояния).
- 5–10% — e2e UI (видимость UI/игрока/кнопок/интеракция + сверка через API).

## Локальная разработка и Mock API

При запуске `npm run dev` (Vite) используется локальный Mock API (middleware в `vite.config.ts`), который
эмулирует бэкенд `/api/state`. Он хранит состояние in-memory, поэтому:
- состояние сохраняется между перезагрузками страницы (пока работает dev-сервер);
- это позволяет прогонять полноценные сценарии локально;
- `src/main.ts` имеет фоллбек: если API недоступен или возвращает ошибку, игра работает в оффлайн-режиме.

## Совместимость и развитие

- Новые общие модули развиваются в `/packages/*`.
- Старые игры могут фиксировать версии (или вендорить) и не обязаны обновляться.

## Текущий стек (зафиксировано)

- TypeScript, Phaser 3, Vite, Vitest, Playwright, npm.
- Деплой: Vercel, размещение каждой игры по пути `/games/<game-name>/`.

## Если пользователь спросил про token usage (Codex CLI)

- Док: `docs/codex-token-usage.md`
- Скрипт: `scripts/codex_token_usage.py --date YYYY-MM-DD` (см. `--mode request`)

## Игры (описания)

См. `docs/games.md`.

## Идеи и концепции

- Общие концепции и "5 идей" находятся в `docs/ideas/`.
- Эти файлы не использовать при реализации конкретных игр.
