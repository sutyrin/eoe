# AGENTS (steppy-scroller)

Локальные инструкции для игры Steppy Scroller.

## Важно

Без прямого указания пользователя не использовать материалы из `docs/ideas/` при работе над этой игрой.

## TODO (Steppy Scroller)

Если пользователь просит "выполнить следующую задачу", агент начинает с первого пункта ниже и идет по порядку.

- [ ] реализовать механику бесконечной генерации уровня (препятствия, дорога).
- [ ] добавить условия проигрыша (столкновения с препятствиями) и систему набора очков (Score).
- [ ] заменить SVG-заглушки на качественные пиксель-арт ассеты.
- [ ] настроить GitHub Actions для автоматического запуска smoke-тестов после деплоя.

## Краткая концепция

Вертикальный лабиринт 4–6 колонок, герой у нижней части экрана, игрок выбирает следующий шаг.
После шага поле сдвигается вниз (игрок визуально идет вверх). Управление в нижней трети экрана.

## Зафиксированные решения

- Тематика: Mountain Climber.
- Механика: Resource Management (каждый шаг расходует ресурс).

## План реализации (инкременты + DoD)

Каждый шаг — полностью играбельная версия. Definition of Done (DoD) обязателен.

### Шаг 1 — Базовый loop (шаг + высота + стамина)

Цель: рабочий пошаговый подъем с единственным ресурсом.

DoD:
- Игрок делает ход в 3 направления (вверх, вверх‑лево, вверх‑право).
- Поле сдвигается вниз после хода, высота (Altitude) растет на +1.
- Ресурс Stamina уменьшается на 1 за шаг; при 0 наступает поражение.
- Экран поражения/рестарт существует и не ломает state.
- Game API отражает Stamina, позицию и Altitude; UI читает их из state.

### Шаг 2 — Препятствия и столкновения

Цель: базовый риск выбора пути.

DoD:
- Генерация препятствий (скалы) с гарантией проходимого пути.
- Столкновение с препятствием приводит к поражению.
- Доступные клетки подсвечены; недоступные визуально читаемы.
- Game API валидирует ход (нельзя шагнуть в блок).

### Шаг 3 — Доп. ресурсы (Warmth, O₂)

Цель: полноценное Resource Management.

DoD:
- Добавлены Warmth и O₂ в state.
- Ледяные тайлы снижают Warmth; высота снижает O₂.
- Тайлы‑бонусы (укрытие, кислород) восстанавливают ресурсы.
- Поражение при 0 по любому ресурсу.
- UI отображает все ресурсы и их изменения.

### Шаг 4 — Score и базовая прогрессия

Цель: метрики и мотивация.

DoD:
- Score = Altitude + бонусы за предметы.
- Редкие бонус‑тайлы (флаг/сувенир) добавляют очки.
- Экран поражения показывает итоговый Score и лучший результат.
- Логика подсчета покрыта тестом через Game API.

### Шаг 5 — Баланс и динамическая сложность

Цель: контролируемый рост сложности.

DoD:
- Пулы тайлов меняются с ростом высоты (больше льда/ветра, меньше укрытий).
- Генератор гарантирует связный путь в каждом ряду.
- Настроены базовые вероятности тайлов (фиксируются в конфиге).
- Не возникает “смертельных” рядов без возможного хода.

### Шаг 6 — Арт/аудио/полиш

Цель: визуальная и аудио‑цельность.

DoD:
- Пиксель‑арт тайлы и персонаж заменяют заглушки.
- Атмосферные эффекты (ветер/снег) без просадки FPS.
- SFX на шаги/ресурсы + тихий ambient.
- Итоговый геймплей не меняет state, только отображение.

## E2E smoke (Playwright)

Локально (поднимается dev‑сервер с in-memory Mock API для `/api/state`):
```
cd games/steppy-scroller
npm run test:e2e
```

Vercel smoke (без локального сервера):
```
cd games/steppy-scroller
E2E_BASE_URL="https://steppy-scroller.vercel.app" npm run test:e2e
```

Отладка:
```
PWDEBUG=1 npm run test:e2e
```

Ожидания тестов: `window.__MCP__` доступен, есть `#controls .action`, и есть `#game-root canvas`.

## Каноничные URL (обновлять при деплое)

- Steppy Scroller (Vercel, prod): `https://steppy-scroller.vercel.app` (проверено 2025-12-21)

## Скриншот (вертикальный)

Команда:
```bash
cd games/steppy-scroller
npm run screenshot
```

Результат сохраняется в `games/steppy-scroller/screenshots/` с именем `game-screenshot-<timestamp>.png`.
