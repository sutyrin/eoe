<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phaser 3 Vertical Dodger</title>
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #1e1f26; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
<script>
(() => {
    const GAME_WIDTH = 480;
    const GAME_HEIGHT = 720;

    const config = {
        type: Phaser.AUTO,
        width: GAME_WIDTH,
        height: GAME_HEIGHT,
        backgroundColor: "#1e1f26",
        physics: {
            default: "arcade",
            arcade: { gravity: { y: 0 }, debug: false },
        },
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: GAME_WIDTH,
            height: GAME_HEIGHT,
        },
        scene: {
            preload,
            create,
            update,
        },
    };

    const game = new Phaser.Game(config);

    let player;
    let cursors;
    let obstacles;
    let scoreText;
    let score = 0;
    let gameOver = false;

    function preload() {
        // Create textures at runtime.
        const gfx = this.make.graphics({ x: 0, y: 0, add: false });
        gfx.fillStyle(0x2d7bff, 1);
        gfx.fillRect(0, 0, 48, 48);
        gfx.generateTexture("player", 48, 48);
        gfx.clear();
        gfx.fillStyle(0xff4b4b, 1);
        gfx.fillRect(0, 0, 96, 32);
        gfx.generateTexture("obstacle", 96, 32);
    }

    function create() {
        cursors = this.input.keyboard.createCursorKeys();

        player = this.physics.add.sprite(GAME_WIDTH / 2, GAME_HEIGHT - 80, "player");
        player.setCollideWorldBounds(false);

        obstacles = this.physics.add.group();

        scoreText = this.add.text(18, 18, "0", {
            fontFamily: "monospace",
            fontSize: "24px",
            color: "#f3f4f7",
        });

        this.time.addEvent({
            delay: 1000,
            loop: true,
            callback: () => spawnObstacle(this),
        });

        this.time.addEvent({
            delay: 100,
            loop: true,
            callback: () => {
                if (gameOver) return;
                score += 1;
                scoreText.setText(String(score));
            },
        });

        this.physics.add.overlap(player, obstacles, () => onLose(this));

        this.input.keyboard.on("keydown-SPACE", () => {
            if (gameOver) this.scene.restart();
        });

        this.input.on("pointerdown", () => {
            if (gameOver) this.scene.restart();
        });
    }

    function update() {
        if (gameOver) return;

        const speed = 320;
        if (cursors.left.isDown) {
            player.setVelocityX(-speed);
        } else if (cursors.right.isDown) {
            player.setVelocityX(speed);
        } else {
            player.setVelocityX(0);
        }

        if (player.x < 0) player.x = GAME_WIDTH;
        if (player.x > GAME_WIDTH) player.x = 0;

        obstacles.children.iterate((obs) => {
            if (obs && obs.y > GAME_HEIGHT + 60) {
                obs.destroy();
            }
        });
    }

    function spawnObstacle(scene) {
        if (gameOver) return;
        const width = Phaser.Math.Between(40, 140);
        const x = Phaser.Math.Between(0, GAME_WIDTH);
        const obstacle = obstacles.create(x, -40, "obstacle");
        obstacle.setDisplaySize(width, 32);
        obstacle.setVelocityY(240);
        obstacle.setImmovable(true);
        obstacle.setOrigin(0.5, 0.5);
    }

    function onLose(scene) {
        if (gameOver) return;
        gameOver = true;
        scene.physics.pause();

        scene.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2, `Game Over\nScore: ${score}`,
            {
                fontFamily: "monospace",
                fontSize: "32px",
                color: "#ffffff",
                align: "center",
            }).setOrigin(0.5, 0.5);

        scene.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2 + 80, "Press SPACE or tap to restart",
            {
                fontFamily: "monospace",
                fontSize: "18px",
                color: "#c9cbd3",
                align: "center",
            }).setOrigin(0.5, 0.5);
    }
})();
</script>
</body>
</html>
